---
const {
  size = 60,
  strokeOpacity = 0.2, // Slightly bumped up default so the faint part is visible
  strokeWidth = 1,
  fade = 1,            // Max opacity (center of cursor)
  minOpacity = 0.15,   // Min opacity (edges/far away) - Adjust this to tune the "base" visibility
  spotlightRadius = 400
} = Astro.props;

const patternScale = size / 20;

const cssVars = {
  '--strokeOpacity': strokeOpacity,
  '--strokeWidth': strokeWidth,
};
---

<div class="hive-wrap" aria-hidden="true" style={cssVars} transition:persist>
  <svg class="hive" width="100%" height="100%">
    <defs>
      <pattern 
        id="hex" 
        width="17.32" 
        height="20" 
        patternUnits="userSpaceOnUse"
        patternTransform={`scale(${patternScale})`}
      >
        <path
          d="M8.66 1 L16.32 5.5 L16.32 14.5 L8.66 19 L1 14.5 L1 5.5 Z"
          fill="none"
          stroke="rgba(var(--hive-stroke-rgb), var(--strokeOpacity))"
          stroke-width="var(--strokeWidth)"
          stroke-linejoin="round"
          vector-effect="non-scaling-stroke" 
        />
        <path
          d="M17.32 11 L24.98 15.5 L24.98 24.5 L17.32 29 L9.66  Z"
          fill="none"
          stroke="rgba(var(--hive-stroke-rgb), var(--strokeOpacity))"
          stroke-width="var(--strokeWidth)"
          stroke-linejoin="round"
          opacity="0.55"
          vector-effect="non-scaling-stroke"
        />
      </pattern>

      <radialGradient 
        id="spotlight-gradient" 
        gradientUnits="userSpaceOnUse" 
        cx="50%" 
        cy="50%" 
        r={spotlightRadius}
      >
        <stop offset="0%" stop-color={`rgba(255,255,255,${fade})`} />
        
        <stop offset="100%" stop-color={`rgba(255,255,255,${minOpacity})`} />
      </radialGradient>

      <mask id="spotlight-mask">
        <rect width="100%" height="100%" fill="url(#spotlight-gradient)" />
      </mask>
    </defs>

    <rect
      width="100%" height="100%"
      fill="url(#hex)"
      mask="url(#spotlight-mask)"
    />
  </svg>
</div>

<style>
  .hive-wrap {
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
    overflow: hidden;
  }

  .hive {
    width: 100%;
    height: 100%;
    --hive-stroke-rgb: 0, 0, 0;
  }

  :global(.darkmode) .hive {
    --hive-stroke-rgb: 255, 255, 255;
  }
</style>

<script>
  const gradient = document.getElementById('spotlight-gradient');

  if (gradient) {
    const setPos = (x, y) => {
      gradient.setAttribute('cx', x.toString());
      gradient.setAttribute('cy', y.toString());
    };

    // Center initially
    setPos(window.innerWidth / 2, window.innerHeight / 2);

    // Follow mouse
    document.addEventListener('mousemove', (e) => {
      setPos(e.clientX, e.clientY);
    });

    // Handle Resize (keep it roughly centered if user hasn't moved mouse yet)
    window.addEventListener('resize', () => {
       // Optional: logic to reset if needed
    });
  }
</script>